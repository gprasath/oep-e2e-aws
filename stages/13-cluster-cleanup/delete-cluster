#!/bin/bash

set -e

mkdir ~/.kube
mkdir -p /tmp/aws
mkdir -p /tmp/awscluster
cp .kube/config ~/.kube/config
cp .kube/resources/id.csv /tmp/aws/id.csv
cp $path/.awscluster/resources/id.csv /tmp/awscluster/id.csv

path=$(pwd)
echo '#### AWS CONFIG ####'
mkdir -p ~/.aws
cp $AWS_CREDS ~/.aws/credentials
ls ~/.aws/
sudo bash -c "aws configure list"
git clone https://github.com/mayadata-io/litmus.git
cd litmus/k8s/aws/k8s-installer

echo '#### Delete Cluster 1 ####'
ansible-playbook delete-aws-cluster.yml -vv --extra-vars "region=eu-central-1 zone=eu-central-1a"
sleep 30

echo '#### Delete Cluster 2 ####'
rm -rf /tmp/aws
sleep 1
mkdir -p /tmp/aws
sleep 1
cp /tmp/awscluster/id.csv /tmp/aws/id.csv

ansible-playbook delete-aws-cluster.yml -vv --extra-vars "region=eu-central-1 zone=eu-central-1a"
sleep 30