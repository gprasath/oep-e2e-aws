#!/bin/bash

set -e

mkdir ~/.kube
mkdir -p /tmp/aws
cp .kube/config ~/.kube/config
cp .kube/resources/cluster_name.csv /tmp/aws/cluster_name.csv
cp .kube/resources/id.csv /tmp/aws/id.csv

ls /tmp/aws

path=$(pwd)
echo '#### AWS CONFIG ####'
mkdir -p ~/.aws
cp $AWS_CREDS ~/.aws/credentials
ls ~/.aws/
sudo bash -c "aws configure list"
git clone https://github.com/mayadata-io/litmus.git
cd litmus/k8s/aws/k8s-installer

echo '#### Cluster 1 ####'
ansible-playbook delete-aws-cluster.yml -vv --extra-vars "region=eu-central-1 zone=eu-central-1a"
sleep 30

echo '#### Cluster 2 ####'
rm -rf /tmp/aws
sleep 1
mkdir -p /tmp/aws
sleep 1
cp .awscluster/resources/id.csv /tmp/aws/id.csv
ansible-playbook delete-aws-cluster.yml -vv --extra-vars "region=eu-central-1 zone=eu-central-1a"
sleep 30